#!/usr/bin/env node

var util = require('util'),
    path = require('path'),
    argv = require('optimist').argv,
    pinpoint = require('../lib/pinpoint');
    
var help = [
    "usage: server [options]",
    "",
    "Runs the demo pinpoint server at the appropriate stage in development",
    "",
    "options:",
    "  -p             Port that you want the home server to run on      [8000]",
    "  -s, --setup    Indicates we should configure the database first  [false]",
    "  -a, --auth     user:password combo to use for HTTP Basic Auth    [none]",
    "  -h, --help     You're staring at it",
].join('\n');

if (argv.h || argv.help) {
  return console.log(help);
}

var port = argv.p || 8000;

pinpoint.start({
  port:      port,
  setup:     argv.s || argv.setup || false, 
  basicAuth: argv.a || argv.auth  || null
}, function (err, server) {
  if (err) {
    return console.log('Error starting pinpoint server: ' + err.message);
  }
  
  console.log('Pinpoint demo server on http://127.0.0.1:' + port);
});

